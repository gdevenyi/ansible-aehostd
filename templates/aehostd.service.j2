#-----------------------------------------------------------------------
# initiate:   systemctl enable aehostd.service
# start:      systemctl start aehostd.service
# get status: systemctl status aehostd.service
#
# {{ ansible_managed }}
#-----------------------------------------------------------------------

[Unit]
Description=NSS/PAM service for AE-DIR
Requires=local-fs.target network.target
After=local-fs.target network.target

[Service]
Type=simple
PIDFile={{ aehostd_pid_file }}
User={{ aehostd_user }}
Group={{ aehostd_group }}
# force libldap to ignore ldap.conf
Environment=LDAPNOINIT=1
# let Python use random object identifier
Environment=PYTHONHASHSEED=random
# full optimization (especially __debug__ = False)
Environment=PYTHONOPTIMIZE=2
# avoid to accidentially write Python byte code
Environment=PYTHONDONTWRITEBYTECODE=1
ExecStart={{ aehostd_exec }} --no-fork --config {{ aehostd_conf_file }} --pid {{ aehostd_pid_file }}
Restart=always
StandardError=syslog
# various hardening options
CapabilityBoundingSet=
AmbientCapabilities=
PrivateTmp=yes
ProtectSystem=full
ProtectHome=yes
ProtectKernelModules=yes
ProtectKernelTunables=yes
ProtectControlGroups=yes
NoNewPrivileges=yes
MountFlags=private
SystemCallArchitectures=native
PrivateDevices=yes
LockPersonality=yes
RestrictRealtime=yes
RestrictNamespaces=yes
SystemCallFilter=~ @clock @cpu-emulation @debug @keyring @module @mount @raw-io @reboot @swap @obsolete
RestrictAddressFamilies=AF_INET AF_INET6 AF_UNIX

{% if apparmor_enabled %}
#AppArmorProfile=aehostd
{% endif %}

[Install]
WantedBy=multi-user.target
