# Configuration for AE-DIR's custom NSS/PAM host demon
#
# {{ ansible_managed }}

[aehostd]

# pathname of Unix domain socket for listening to incoming PAM and NSS requests
socketpath = {{ aehostd_socket }}

# The user and group to run as
uid = {{ aehostd_user }}
gid = {{ aehostd_group }}

# for debugging set this below 20
loglevel = {{ aehostd_loglevel }}
# Path name of syslog socket: Setting this to a string enforces using syslog,
# empty string results in default /dev/log being used
logsocket = 

# The location at which the LDAP server(s) should be reachable
# these LDAP URIs are tried first in this order no matter what
uri_list = {{ ldap_uri_list|join(' ') }}
# these LDAP URIs are tried after all in uri_list failed
# (to balance load this list will be rotated based on FQDN hash)
uri_pool = {{ ldap_uri_pool|join(' ') }}

# preferred short bind-DN form (relocatable)
binddn = host={{ inventory_hostname }},{{ ldap_suffix }}
# pathname of file containing password for the above binddn
bindpwfile = {{ aehostd_pw_file }}

# TLS options
tls_cacertfile = {{ ldap_cacert_pathname }}

# local password changes not allowed
pam_passmod_deny_msg = Changing password on local system is not allowed for this user!

# Check the SSH client's hostname in user entry
pam_authz_search = {{ pam_authz_search }}

# maximum time to wait for connection and search results
timelimit = 6

# cache TTL for the synchronous LDAP searches
cache_ttl = 5.0

{% if aehostd_sudoers_file %}
# pathname for sudoers export file
sudoers_file = {{ aehostd_sudoers_file }}
{% endif %}

{% if aehostd_sshkeys_dir %}
# where to write SSH authorized keys
sshkeys_dir = {{ aehostd_sshkeys_dir }}
{% endif %}

# home directory beneath /tmp
#homedir_tmpl = /tmp/{username}

# refresh time for passwd and group maps
#refresh_sleep = 60.0

# parent entry level beneath which to search for network address entries
#netaddr_level = 2

# refresh time for hosts map
#netaddr_refresh = 1800.0
