---
# defaults file for roles/ae-dir-hostd

# map real LSB id to another LSB id to be used during plays
lsb_id_map:
  openSUSE: "SUSE"

# LSB id to be used during plays
lsb_id: "{{ lsb_id_map.get(ansible_lsb.id,ansible_lsb.id) }}"

# LDAPS URIs of primary AE-DIR servers (e.g. in same data center)
ldap_uri_list: []

# LDAPS URIs of backup AE-DIR servers (e.g. in other data center)
ldap_uri_pool: []

# search base to use
ldap_suffix: "ou=ae-dir"

# POSIX-UID number range served by LDAP server
ldap_min_uid: 30000
ldap_max_uid: 65000
ldap_min_gid: 30000
ldap_max_gid: 65000

# TLS files
ldap_cacert_filename: "cacert.pem"
ldap_cacert_pathname: "/etc/ssl/{{ ldap_cacert_filename|basename }}"

# nested dict of OS-specific vars
os_vars:
  Debian:
    sshd_service_name: "ssh"
    ssh_lib_dir: "/usr/lib/openssh"
  SUSE:
    sshd_service_name: "sshd"
    ssh_lib_dir: "/usr/lib/ssh"

# which module name to use in /etc/nsswitch.conf
nsswitch_module: "aedir"
# which module name to use in /etc/pam.d
pam_module: "pam_{{ nsswitch_module }}.so"

# process username and group for setuid
aehostd_uid: "aehostd"
aehostd_gid: "{{ aehostd_uid }}"

# Python logging level
aehostd_loglevel: "20"

# Pathnames of aehostd's files and directories
aehostd_exec: "/usr/sbin/aehostd"
aehostd_conf_file: "/etc/aehostd.conf"
aehostd_lib_dir: "/var/lib/{{ aehostd_uid }}"
aehostd_sshkeys_dir: "{{ aehostd_lib_dir }}/sshkeys"
aehostd_db_dir: "{{ aehostd_lib_dir }}/db"
aehostd_run_dir: "/var/run/{{ aehostd_uid }}"
aehostd_pw_file: "{{ aehostd_lib_dir }}/aehostd.pw"
aehostd_sudoers_file: "{{ aehostd_lib_dir }}/ae-dir-sudoers-export"
aehostd_pid_file: "{{ aehostd_run_dir }}/aehostd.pid"
# Path name of Unix domain socket for listening
# (must match value of nss-pam-ldapd's build-time config option --with-nslcd-socket)
aehostd_socket: "{{ aehostd_run_dir }}/aehostd.sock"

# flag whether to enable nscd
nscd_enabled: False

# pathname of nscd configuration file
nscd_conf_file: "/etc/nscd.conf"

# service name of SSH demon
sshd_service_name: "{{ os_vars[lsb_id].sshd_service_name }}"

# Filename of Jinja2 template file used for generating sshd_config
sshd_config_template: "sshd_config.j2"
sshd_authorized_keys: "/etc/ssh/authorized_keys"

# ListenAddress values
sshd_listen_addresses: []

# File name of emergency authorized keys for user root
ssh_emergency_root_keys: "ssh_emergency_root_keys"

# where to find the system-specific Jinja2 templates
# for creating PAM config files /etc/pam.d/common-*
pam_template_dir: "{{ lsb_id }}"

# LDAP search filter for PAM authorization
#-----------------------------------------
# note that AE-DIR already does this implicit via visibility of aeUser entries

# allow only active users with explicit login rights in AE-DIR
pam_authz_search: "(&(uid={username})(|(pwdChangedTime=*)(userCertificate=*)(sshPublicKey=*)))"

#---------------------------------------------------------------------------
# AppArmor parameters
#---------------------------------------------------------------------------

# set to True to enable mandatory access control with AppArmor
#apparmor_enabled: "{{ ansible_apparmor.status == 'enabled' }}"
apparmor_enabled: False

# where custom AppArmor profiles are stored
apparmor_profiles_dir: "/etc/apparmor.d"
